gdjs.HowlerSound=function(e){Howl.call(this,e),this._paused=!1,this._stopped=!0,this._canBeDestroyed=!1,this._rate=e.rate||1;var o=this;this.on("end",function(){o.loop()||(o._canBeDestroyed=!0,o._paused=!1,o._stopped=!0)}),this.on("playerror",function(e,s){console.error("Can't play a sound, considering it as stopped. Error is:",s),o._paused=!1,o._stopped=!0}),this.on("play",function(){o._paused=!1,o._stopped=!1}),this.on("pause",function(){o._paused=!0,o._stopped=!1})},gdjs.HowlerSound.prototype=Object.create(Howl.prototype),gdjs.HowlerSound.prototype.stop=function(){return this._paused=!1,this._stopped=!0,Howl.prototype.stop.call(this)},gdjs.HowlerSound.prototype.play=function(){return this._paused=!1,this._stopped=!1,Howl.prototype.play.call(this)},gdjs.HowlerSound.prototype.pause=function(){return this._paused=!0,this._stopped=!1,Howl.prototype.pause.call(this)},gdjs.HowlerSound.prototype.paused=function(){return this._paused},gdjs.HowlerSound.prototype.stopped=function(){return this._stopped},gdjs.HowlerSound.prototype.canBeDestroyed=function(){return this._canBeDestroyed},gdjs.HowlerSound.prototype.getRate=function(){return this._rate},gdjs.HowlerSound.prototype.setRate=function(e){this._rate=gdjs.HowlerSoundManager.clampRate(e),this.rate(this._rate)},gdjs.HowlerSoundManager=function(e){this._resources=e,this._availableResources={},this._globalVolume=100,this._sounds={},this._musics={},this._freeSounds=[],this._freeMusics=[],this._pausedSounds=[],this._paused=!1;var o=this;this._checkForPause=function(){o._paused&&(this.pause(),o._pausedSounds.push(this))},document.addEventListener("deviceready",function(){document.addEventListener("pause",function(){var e=o._freeSounds.concat(o._freeMusics);for(var s in o._sounds)o._sounds.hasOwnProperty(s)&&e.push(o._sounds[s]);for(var s in o._musics)o._musics.hasOwnProperty(s)&&e.push(o._musics[s]);for(var t=0;t<e.length;t++){var n=e[t];n.paused()||n.stopped()||(n.pause(),o._pausedSounds.push(n))}o._paused=!0},!1),document.addEventListener("resume",function(){for(var e=0;e<o._pausedSounds.length;e++){var s=o._pausedSounds[e];s.stopped()||s.play()}o._pausedSounds.length=0,o._paused=!1},!1)})},gdjs.SoundManager=gdjs.HowlerSoundManager,gdjs.HowlerSoundManager.prototype.setResources=function(e){this._resources=e},gdjs.HowlerSoundManager.clampRate=function(e){return e>4?4:e<.5?.5:e},gdjs.HowlerSoundManager.prototype._getFileFromSoundName=function(e){return this._availableResources.hasOwnProperty(e)&&this._availableResources[e].file?this._availableResources[e].file:e},gdjs.HowlerSoundManager.prototype._storeSoundInArray=function(e,o){for(var s=null,t=0,n=e.length;t<n;++t)if(null!==e[t]&&e[t].canBeDestroyed())return e[null]=o,o;return e.push(o),o},gdjs.HowlerSoundManager.prototype.playSound=function(e,o,s,t){var n=this._getFileFromSoundName(e),r=new gdjs.HowlerSound({src:[n],loop:o,volume:s/100,rate:gdjs.HowlerSoundManager.clampRate(t)});this._storeSoundInArray(this._freeSounds,r).play(),r.on("play",this._checkForPause)},gdjs.HowlerSoundManager.prototype.playSoundOnChannel=function(e,o,s,t,n){var r=this._sounds[o];r&&r.unload();var a=this._getFileFromSoundName(e),u=new gdjs.HowlerSound({src:[a],loop:s,volume:t/100,rate:gdjs.HowlerSoundManager.clampRate(n)});u.play(),this._sounds[o]=u,u.on("play",this._checkForPause)},gdjs.HowlerSoundManager.prototype.getSoundOnChannel=function(e){return this._sounds[e]},gdjs.HowlerSoundManager.prototype.playMusic=function(e,o,s,t){var n=this._getFileFromSoundName(e),r=new gdjs.HowlerSound({src:[n],loop:o,html5:!0,volume:s/100,rate:gdjs.HowlerSoundManager.clampRate(t)});this._storeSoundInArray(this._freeMusics,r).play(),r.on("play",this._checkForPause)},gdjs.HowlerSoundManager.prototype.playMusicOnChannel=function(e,o,s,t,n){var r=this._musics[o];r&&r.unload();var a=this._getFileFromSoundName(e),u=new gdjs.HowlerSound({src:[a],loop:s,html5:!0,volume:t/100,rate:gdjs.HowlerSoundManager.clampRate(n)});u.play(),this._musics[o]=u,u.on("play",this._checkForPause)},gdjs.HowlerSoundManager.prototype.getMusicOnChannel=function(e){return this._musics[e]},gdjs.HowlerSoundManager.prototype.setGlobalVolume=function(e){this._globalVolume=e,this._globalVolume>100&&(this._globalVolume=100),this._globalVolume<0&&(this._globalVolume=0),Howler.volume(this._globalVolume/100)},gdjs.HowlerSoundManager.prototype.getGlobalVolume=function(){return this._globalVolume},gdjs.HowlerSoundManager.prototype.clearAll=function(){for(var e=0;e<this._freeSounds.length;++e)this._freeSounds[e]&&this._freeSounds[e].unload();for(var e=0;e<this._freeMusics.length;++e)this._freeMusics[e]&&this._freeMusics[e].unload();this._freeSounds.length=0,this._freeMusics.length=0;for(var o in this._sounds)this._sounds.hasOwnProperty(o)&&this._sounds[o]&&(this._sounds[o].unload(),delete this._sounds[o]);for(var o in this._musics)this._musics.hasOwnProperty(o)&&this._musics[o]&&(this._musics[o].unload(),delete this._musics[o]);this._pausedSounds.length=0},gdjs.HowlerSoundManager.prototype.preloadAudio=function(e,o,s){function t(){if(++d===i)return o(i);e(d,i)}s=s||this._resources;for(var n={},r=0,a=s.length;r<a;++r){var u=s[r];if(u.file&&"audio"===u.kind){if(this._availableResources[u.name])continue;this._availableResources[u.name]=u,n[u.file]=(n[u.file]||[]).concat(u)}}var i=Object.keys(n).length;if(0===i)return o(i);var d=0,l=this;for(var p in n)if(n.hasOwnProperty(p)){var h=new XMLHttpRequest;h.addEventListener("load",t),h.addEventListener("error",t),h.addEventListener("abort",t),h.open("GET",p),h.send()}};